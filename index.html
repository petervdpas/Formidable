<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="
  default-src 'self';
  script-src 'self' blob:;
  img-src 'self' data:;
  style-src 'self' 'unsafe-inline';
  font-src 'self' data:;
"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="dark light" />
    <title>AppTitle</title>

    <!-- Core Styles -->
    <link rel="stylesheet" href="assets/layout.css" />
    <link rel="stylesheet" href="assets/pilled-badge.css" />
    <link rel="stylesheet" href="assets/switch.css" />
    <link rel="stylesheet" href="assets/tabs.css" />
    <link rel="stylesheet" href="assets/toast.css" />
    <link rel="stylesheet" href="assets/inputs.css" />
    <link rel="stylesheet" href="assets/menu.css" />
    <link rel="stylesheet" href="assets/statusbar.css" />
    <link rel="stylesheet" href="assets/meta-section.css" />
    <link rel="stylesheet" href="assets/forms.css" />
    <link rel="stylesheet" href="assets/fields.css" />
    <link rel="stylesheet" href="assets/code-mode.css" />
    <link rel="stylesheet" href="assets/loopblocks.css" />
    <link rel="stylesheet" href="assets/option-grid.css" />
    <link rel="stylesheet" href="assets/option-list.css" />
    <link rel="stylesheet" href="assets/option-panel.css" />
    <link rel="stylesheet" href="assets/options-edit.css" />
    <link rel="stylesheet" href="assets/popup.css" />
    <link rel="stylesheet" href="assets/buttons.css" />
    <link rel="stylesheet" href="assets/plugins.css" />
    <link rel="stylesheet" href="assets/links.css" />
    <link rel="stylesheet" href="assets/sortable.css" />
    <link rel="stylesheet" href="assets/modal.css" />
    <link rel="stylesheet" href="assets/field-types.css" />
    <link rel="stylesheet" href="assets/miniExpression.css" />
    <link rel="stylesheet" href="assets/git-actions.css" />
    <link rel="stylesheet" href="assets/help.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="assets/fontawesome/font-awesome.min.css" />

    <!-- CodeMirror Styles -->
    <link rel="stylesheet" href="assets/codemirror/codemirror.css" />
    <link id="cm-theme" rel="stylesheet" href="assets/codemirror/eclipse.css" />
    <link id="cm-theme" rel="stylesheet" href="assets/codemirror/monokai.css" />

    <!-- EasyMDE -->
    <link rel="stylesheet" href="assets/easymde/easymde.min.css" />
    <link rel="stylesheet" href="assets/hljs/github.min.css" />

    <!-- CodeMirror extras -->
    <link rel="stylesheet" href="assets/cm-editor.css" />

    <!-- THEME — load AFTER EasyMDE so our values/rules win -->
    <link rel="stylesheet" href="assets/themes/common.css" />

    <link id="formidable-theme-light" rel="stylesheet" href="assets/themes/light.css" />
    <link id="formidable-theme-dark" rel="stylesheet" href="assets/themes/dark.css" />
  </head>
  <body>
    <div id="main-wrapper">
      <div id="app-menu">
        <div class="menu-bar-container">
          <ul class="menu-bar">
            <!-- Menu items -->
          </ul>
        </div>
      </div>

      <!-- Template Form Editor Context -->
      <div id="template-container">
        <div id="template-sidebar">
          <h3 data-i18n="standard.templates">Templates</h3>
          <div id="template-list"></div>
        </div>
        <div id="template-splitter">
          <div
            id="template-resizeHandle"
            title="Drag to Resize"
            data-i18n-title="resize.handle.title"
          ></div>
        </div>
        <div id="template-workspace">
          <section id="template-content">
            <p data-i18n="sidebar.templates.placeholder">
              Select or create a template-file to begin editing.
            </p>
          </section>
        </div>
      </div>

      <!-- Markdown Document Editor Context -->
      <div id="storage-container" style="display: none">
        <div id="storage-sidebar">
          <div id="template-selector"></div>
          <h3 data-i18n="standard.forms">Forms</h3>
          <div id="storage-list"></div>
        </div>
        <div id="storage-splitter">
          <div
            id="storage-resizeHandle"
            title="Drag to Resize"
            data-i18n-title="resize.handle.title"
          ></div>
        </div>
        <div id="storage-workspace">
          <section id="storage-content">
            <p data-i18n="sidebar.forms.placeholder">
              Select or create a form-file to begin.
            </p>
          </section>
        </div>
      </div>
      <!-- Shared Status Bar -->
      <div id="status-bar">
        <div id="status-bar-message">
          <span data-i18n="standard.ready">>Ready.</span>
        </div>
        <div id="status-bar-buttons"></div>
        <div id="status-bar-info"></div>
      </div>
    </div>

    <!-- Profile Switch Modal -->
    <div id="profile-modal" class="modal">
      <div class="modal-header">
        <div class="modal-title-row">
          <h2 data-i18n="modal.profile.title">Switch User Profile</h2>
        </div>
      </div>
      <div class="modal-body" id="profile-body">
        <!-- Filled dynamically -->
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
      <div class="modal-header">
        <div class="modal-title-row">
          <h2 data-i18n="standard.settings">Settings</h2>
          <div
            id="current-profile"
            class="pilled-badge pilled-badge--success"
          ></div>
          <div id="settings-inject-button"></div>
        </div>
      </div>
      <div class="modal-body" id="settings-body">
        <!-- Populated dynamically via settingsManager -->
      </div>
    </div>

    <!-- Workspace Modal -->
    <div id="workspace-modal" class="modal">
      <div class="modal-header">
        <div class="modal-title-row">
          <h2 data-i18n="modal.workspace.title">Workspace Settings</h2>
        </div>
      </div>
      <div class="modal-body" id="workspace-body">
        <!-- Populated dynamically via settingsManager or a new workspaceManager -->
      </div>
    </div>

    <!-- Template Creation Modal -->
    <div id="template-modal" class="modal">
      <div class="modal-header">
        <div class="modal-title-row">
          <h2 data-i18n="modal.template.title">New Template</h2>
        </div>
      </div>
      <div class="modal-body">
        <div class="modal-form-row">
          <label for="template-name" data-i18n="standard.filename"
            >Filename</label
          >
          <input
            type="text"
            id="template-name"
            placeholder="e.g., user-survey"
            data-i18n-placeholder="modal.template.placeholder.filename"
          />
        </div>
        <div id="template-modal-buttons-wrapper"></div>
      </div>
    </div>

    <!-- Entry Prompt Modal -->
    <div id="entry-modal" class="modal">
      <div class="modal-header">
        <div class="modal-title-row">
          <h2 data-i18n="modal.entry.title">New Entry</h2>
        </div>
      </div>
      <div class="modal-body">
        <div class="modal-form-row">
          <label for="entry-name" data-i18n="modal.entry.label.name">
            Enter a name for this entry:
          </label>
          <input
            type="text"
            id="entry-name"
            placeholder="e.g. my-article-title"
            data-i18n-placeholder="modal.entry.placeholder.name"
          />
        </div>
        <div class="modal-form-row switch-row">
          <label
            for="entry-append-date"
            data-i18n="modal.entry.label.appendDate"
          >
            Append date (YYYYMMDD)
          </label>
          <label class="switch">
            <input type="checkbox" id="entry-append-date" checked />
            <span class="slider"></span>
          </label>
        </div>
        <div id="entry-modal-buttons-wrapper"></div>
      </div>
    </div>

    <!-- Field Edit Modal -->
    <div id="field-edit-modal" class="modal">
      <div class="modal-header">
        <div class="modal-title-row">
          <h2 data-i18n="modal.field.title">Edit Field</h2>
        </div>
      </div>

      <div class="modal-body">
        <div class="modal-form-row" style="display: none">
          <input type="hidden" id="edit-primary-key" value="false" />
        </div>

        <div class="modal-form-row">
          <label for="edit-key" data-i18n="standard.key">Key</label>
          <input type="text" id="edit-key" />
        </div>

        <div class="modal-form-row" id="edit-type-container">
          <!-- Type dropdown will be injected here -->
        </div>

        <div class="modal-form-row" id="edit-format-row" style="display: none">
          <label for="edit-format" data-i18n="field.format">Format</label>
          <select id="edit-format">
            <option value="markdown" data-i18n="field.format.markdown">
              Markdown
            </option>
            <option value="plain" data-i18n="field.format.plain">
              Plain text
            </option>
          </select>
        </div>

        <div class="modal-form-row" id="edit-summary-field-container">
          <!-- Dropdown will be injected here -->
        </div>

        <div class="modal-form-row switch-row">
          <label for="edit-expression-item" data-i18n="field.expression"
            >Expression field</label
          >
          <label class="switch">
            <input type="checkbox" id="edit-expression-item" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="modal-form-row switch-row">
          <label for="edit-two-column" data-i18n="field.twoColumn"
            >Two columns</label
          >
          <label class="switch">
            <input type="checkbox" id="edit-two-column" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="modal-form-row">
          <label for="edit-label" data-i18n="standard.label">Label</label>
          <input type="text" id="edit-label" />
        </div>

        <div class="modal-form-row">
          <label for="edit-description" data-i18n="standard.description"
            >Description</label
          >
          <textarea
            id="edit-description"
            rows="2"
            placeholder="Optional description"
            data-i18n-placeholder="field.placeholder.description"
          ></textarea>
        </div>

        <!-- Code-specific settings -->
        <div
          class="modal-form-row code-only"
          id="edit-runmode-row"
          style="display: none"
        >
          <label for="edit-runmode" data-i18n="field.code.runmode"
            >Run Mode</label
          >
          <select id="edit-runmode">
            <option value="manual" data-i18n="field.code.runmode.manual">
              Manual
            </option>
            <option value="load" data-i18n="field.code.runmode.load">
              On Load
            </option>
            <option value="save" data-i18n="field.code.runmode.save">
              On Save
            </option>
          </select>
        </div>

        <div
          class="modal-form-row switch-row code-only"
          id="edit-allowrun-row"
          style="display: none"
        >
          <label for="edit-allowrun" data-i18n="field.code.allowrun"
            >Allow Execution</label
          >
          <label class="switch">
            <input type="checkbox" id="edit-allowrun" />
            <span class="slider"></span>
          </label>
        </div>

        <div
          class="modal-form-row code-only"
          id="edit-inputmode-row"
          style="display: none"
        >
          <label for="edit-inputmode" data-i18n="field.code.inputmode"
            >Input Mode</label
          >
          <select id="edit-inputmode">
            <option value="safe" data-i18n="field.code.inputmode.safe">
              Safe (data-only)
            </option>
            <option value="raw" data-i18n="field.code.inputmode.raw">
              Raw (same realm)
            </option>
          </select>
        </div>

        <div
          class="modal-form-row code-only"
          id="edit-apimode-row"
          style="display: none"
        >
          <label for="edit-apimode" data-i18n="field.code.apimode"
            >API Exposure</label
          >
          <select id="edit-apimode">
            <option value="frozen" data-i18n="field.code.apimode.frozen">
              Frozen (read-only)
            </option>
            <option value="raw" data-i18n="field.code.apimode.raw">
              Raw (live objects)
            </option>
          </select>
        </div>
        <div
          class="modal-form-row code-only"
          id="edit-apipick-row"
          style="display: none"
        >
          <label for="edit-apipick">
            <span data-i18n="field.code.apipick">API Whitelist</span>
            <small class="label-subtext" data-i18n="field.code.apipick.hint">
              Which API keys to expose?
            </small>
          </label>
          <textarea
            id="edit-apipick"
            rows="2"
            placeholder="e.g. path,string,plugin"
            data-i18n-placeholder="field.code.apipick.placeholder"
          ></textarea>
        </div>

        <!-- LaTeX-specific settings (minimal) -->
        <div
          class="modal-form-row switch-row latex-only"
          id="edit-latex-usefenced-row"
          style="display: none"
        >
          <label for="edit-latex-usefenced" data-i18n="field.latex.usefenced"
            >Use fenced raw block</label
          >
          <label class="switch">
            <input type="checkbox" id="edit-latex-usefenced" />
            <span class="slider"></span>
          </label>
        </div>

        <div
          class="modal-form-row latex-only"
          id="edit-latex-rows-row"
          style="display: none"
        >
          <label for="edit-latex-rows" data-i18n="field.latex.rows">Rows</label>
          <input
            type="number"
            id="edit-latex-rows"
            min="2"
            max="60"
            value="10"
            style="width: 72px"
          />
        </div>

        <!-- Default value -->
        <div class="modal-form-row">
          <label for="edit-default" data-i18n="standard.default.value"
            >Default value</label
          >
          <textarea
            id="edit-default"
            rows="2"
            placeholder="Set the default value for this field"
            data-i18n-placeholder="field.placeholder.default"
          ></textarea>
        </div>

        <div class="modal-form-row">
          <label for="edit-options" data-i18n="standard.options">Options</label>
          <textarea
            id="edit-options"
            rows="2"
            placeholder="Comma-separated"
            data-i18n-placeholder="field.placeholder.options"
          ></textarea>
        </div>

        <div id="field-edit-buttons-wrapper"></div>
      </div>
    </div>

    <!-- Markdown Preview Modal -->
    <div id="render-modal" class="modal large">
      <div class="modal-header">
        <div class="modal-title-row">
          <h2 data-i18n="modal.render.title">
            Render Markdown &amp; HTML Preview
          </h2>
          <!-- Toggle buttons will be injected here -->
        </div>
      </div>
      <div class="modal-body two-pane">
        <div class="pane raw-pane">
          <div class="pane-header">
            <h4 data-i18n="standard.markdown">Markdown</h4>
            <div id="copy-markdown-button-wrapper"></div>
          </div>
          <pre id="render-output" class="output-block"></pre>
        </div>
        <div class="pane html-pane">
          <div class="pane-header">
            <h4 data-i18n="standard.preview.html">HTML Preview</h4>
            <div id="copy-preview-button-wrapper"></div>
          </div>
          <div id="render-preview" class="output-block preview-block"></div>
        </div>
      </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirm-modal" class="modal hidden">
      <div class="modal-content">
        <p id="confirm-message"></p>
        <div id="confirm-buttons-wrapper"></div>
      </div>
    </div>

    <!-- Git Actions Modal -->
    <div id="git-actions-modal" class="modal">
      <div class="modal-header">
        <div class="modal-title-row">
          <h2 data-i18n="modal.git.title">Git Actions</h2>
        </div>
      </div>
      <div class="modal-body" id="git-modal-body">
        <!-- Will be filled dynamically -->
      </div>
    </div>

    <!-- Plugin Manager Modal -->
    <div id="plugin-manager-modal" class="modal">
      <div class="modal-header">
        <div class="modal-title-row">
          <h2 data-i18n="modal.plugins.title">Plugin Manager</h2>
        </div>
      </div>
      <div class="modal-body" id="plugin-manager-body">
        <!-- Will be rendered dynamically -->
      </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal">
      <div class="modal-header">
        <div class="modal-title-row">
          <h2 data-i18n="modal.help.title">Formidable Help Pages</h2>
        </div>
      </div>
      <div class="modal-body" id="help-body">
        <!-- Populated dynamically via helperUI -->
      </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="modal">
      <div class="modal-header">
        <div class="modal-title-row">
          <h2 id="about-title" data-i18n="modal.about.title">AppTitle</h2>
        </div>
      </div>
      <div class="modal-body">
        <div class="about-content">
          <img
            src="assets/formidable.ico"
            alt="Formidable Icon"
            class="about-icon"
          />
          <div class="about-text">
            <p data-i18n="modal.about.description">
              Formidable is a Template/Form Editor created in Electron.
            </p>
            <p data-i18n="modal.about.copyright">©2025 Peter van de Pas</p>
          </div>
        </div>
      </div>
    </div>

    <div id="status-button-popup" class="popup-panel">
      <!-- content will be injected here -->
    </div>

    <!-- Plugin container -->
    <div id="plugin-executor"></div>

    <div id="modalBackdrop" class="modal-backdrop"></div>
    <div id="toast-container"></div>

    <!-- CodeMirror Scripts -->
    <script src="assets/codemirror/codemirror.js"></script>
    <script src="assets/codemirror/yaml.js"></script>
    <script src="assets/codemirror/javascript.js"></script>
    <script src="assets/codemirror/stex.js"></script>

    <!-- SortableJs -->
    <script src="assets/sortable/sortable.min.js"></script>

    <!-- EasyMDE -->
    <script src="assets/easymde/easymde.min.js"></script>

    <script type="module" src="renderer.js"></script>
  </body>
</html>
